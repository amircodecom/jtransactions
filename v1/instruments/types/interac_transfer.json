{
  "$id": "https://yourdomain.com/schemas/v1/instruments/types/interac_transfer.json",
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "InteracTransferInstrument",
  "description": "Interac e-Transfer payment instrument (Canada)",
  "type": "object",
  "allOf": [
    { "$ref": "../base/instrument.json" },
    {
      "properties": {
        "type": { "const": "interac_transfer" },
        "interac_transfer": {
          "type": "object",
          "properties": {
            "reference_number": {
              "type": "string",
              "pattern": "^[A-Z0-9]{10,20}$",
              "description": "Interac transaction reference number"
            },
            "financial_institution": {
              "type": "string",
              "enum": ["RBC", "TD", "Scotiabank", "BMO", "CIBC", "Desjardins", "National Bank", "Other"],
              "description": "Sending bank/institution"
            },
            "contact_used": {
              "type": "string",
              "enum": ["email", "mobile"],
              "description": "Which contact method was used for this transfer"
            },
            "recipient_email": {
              "type": "string",
              "format": "email",
              "description": "Recipient email address"
            },
            "recipient_mobile": {
              "type": "string",
              "pattern": "^\\+?1?[0-9]{10}$",
              "description": "Recipient mobile number in E.164 format"
            },
            "auto_deposit_enabled": {
              "type": "boolean",
              "default": false,
              "description": "Whether recipient has auto-deposit enabled"
            },
            "security_question": {
              "type": "string",
              "description": "Required when auto_deposit_enabled=false and contact_used=email"
            },
            "security_answer_attempts": {
              "type": "integer",
              "minimum": 0,
              "maximum": 3,
              "description": "Number of failed security answer attempts"
            }
          },
          "required": ["reference_number", "financial_institution", "contact_used"],
          "allOf": [
            {
              "if": {
                "properties": {
                  "contact_used": { "const": "email" }
                }
              },
              "then": {
                "required": ["recipient_email"]
              }
            },
            {
              "if": {
                "properties": {
                  "contact_used": { "const": "mobile" }
                }
              },
              "then": {
                "required": ["recipient_mobile"]
              }
            },
            {
              "if": {
                "properties": {
                  "contact_used": { "const": "email" },
                  "auto_deposit_enabled": { "const": false }
                }
              },
              "then": {
                "required": ["security_question"]
              }
            }
          ]
        }
      },
      "required": ["interac_transfer"]
    }
  ]
}
